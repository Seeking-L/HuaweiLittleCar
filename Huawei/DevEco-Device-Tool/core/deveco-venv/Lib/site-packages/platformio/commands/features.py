# noinspection PyPackageRequirements
import json
import platform
import click
import platformio.feature


@click.group(short_help="Feature Manager")
def cli():
    pass


@cli.command("show", short_help="Show feature status", hidden=True)
@click.option("--name", default=None, help='name of feature, if omitted show all features')
@click.option("--os_system", default=None, help='specify a target OS, if omitted use current OS')
@click.option("--json-output", is_flag=True)
def features_show(name, os_system, json_output):
    if os_system is None:
        os_system = platform.system().lower()
    names = platformio.feature.get_list() if name is None else [name]

    result = {}
    for n in names:
        result[n] = platformio.feature.get(name=n, os_system=os_system)

    result = {k: v for k, v in result.items() if v is not None}

    if json_output:
        click.echo(json.dumps(result))
    else:
        click.echo(f'Features for OS "{os_system}":')
        for k, v in result.items():
            click.echo(f'{k} = {v}')
