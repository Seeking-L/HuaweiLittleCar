# -*- coding: utf-8 -*-
"""
Copyright (c) Huawei Technologies Co., Ltd. 2021-2021. All rights reserved.
Description:
Create: 2022-03-17
"""

import click
from platformio.commands.dotting.helpers import start_trace_service, service_started, stop_trace_service
from platformio.compat import dump_json_to_unicode


@click.group(short_help="start dotting ide")
def cli():
    pass


@cli.command("init")
@click.option("-o", "--operation",  help="start or stop trace server")
def start_dotting_server(operation):
    msg = "server is exists"
    server_status = True
    if operation == "start":  # pylint: disable=no-else-return
        if service_started():
            return click.echo(
                dump_json_to_unicode({'code': False, "msg": msg})
            )
        msg = "fail!" if not start_trace_service() else "succeess!"
        return click.echo(dump_json_to_unicode({'code': False, "msg": msg}))
    else:
        if service_started():
            server_status = stop_trace_service()
        return click.echo(dump_json_to_unicode({'code': server_status}))
